define(['jquery', 'shared/models/BaseCollection', 'shared/models/BaseModel'
], function ($, BaseCollection, BaseModel) {

  var ConnectorAgent = BaseModel.extend({
    initialize: function () {
      this.on('change:status', this.statusChange, this);
    },

    statusChange: function () {
      var newStatus = this.get('status');
      var self = this;
      $.ajax({
        type: 'POST',
        url: '/api/internal/connector/agent-status/' + this.get('id') + '?status=' + newStatus,
        success: function () {
          if (newStatus === 'DELETED') {
            self.destroy();
          }
        },
        error: function (jqXHR) {
          self.trigger('errorMessage', jqXHR.responseJSON.errorSummary);
        }
      });
    },

    isActive: function () {
      return this.get('status') === 'ACTIVE';
    }
  });

  var ConnectorAgents = BaseCollection.extend({
    model : ConnectorAgent,
    initialize : function (models, options) {
      this.instanceId = options.instanceId;
    },
    url : function () {
      return '/api/internal/connector/' + this.instanceId + '/agents';
    }
  });

  return {
    Model : ConnectorAgent,
    Collection : ConnectorAgents
  };
});
