/* eslint max-params: [2, 6] */
define([
  'underscore',
  'shared/util/UrlExpander',
  'shared/models/BaseModel',
  'shared/models/BaseCollection',
  'shared/models/BaseSchema',
  'shared/models/SchemaProperty'
], function (_, UrlExpander, BaseModel, BaseCollection, BaseSchema, SchemaProperty) {

  var BaseUserProfile = BaseModel.extend({
    defaults: {
      id: undefined,
      // user/app/directory profile display name (app instance display name + ' User'), ex 'Salesforce.com (2) User'
      // app instance display name can be found when expand=app, in _embedded.app.label
      displayName: undefined,
      name: undefined, // profile name (unique, not changable), ex salesforce_1
      expandQuery: function () {
        return this.expander.toString();
      },
      properties: BaseModel.ComputedProperty(['_embedded'], function (embedded) {
        var c = new SchemaProperty.Collection(),
            properties;
        if (embedded && embedded.schemas) {
          properties = _.reduce(embedded.schemas, function (init, schema) {
            return init.concat(BaseSchema.parseProperties(schema));
          }, []);
          c.reset(properties, {silent: true, parse: true});
        }
        return c;
      })
    },

    initialize: function (attrs, options) {
      options || (options = {});
      this.instanceId = options.instanceId;
      this.expander = new UrlExpander(options.expand);
    }

  });

  var BaseUserProfiles = BaseCollection.extend({

    model: BaseUserProfile,

    initialize: function (models, options) {
      options || (options = {});
      this.expander = new UrlExpander(options.expand);
    }

  });

  return {
    Model: BaseUserProfile,
    Collection: BaseUserProfiles
  };

});
