define(['shared/views/components/BaseModalDialog',
        'shared/views/components/ErrorMessage'],
function (BaseModalDialog, ErrorMessage) {

  return BaseModalDialog.extend({

    events: {
      'click input': 'sendFeedback'
    },

    title: 'Feedback',
    subtitle: 'Could you let us know why you don\'t want self service enabled?',

    template: '\
<div class="feedbackForm padding-20 padding-top-0">\
  <textarea name="feedback" rows="8" cols="80" id="feedback"></textarea>\
  <div class="padding-top-20 clearfix">\
    <div class="text-primary float-l l-txt padding-top-5">Thank you for your help. We appreciate it.</div>\
    <input type="button" class="button-primary float-r" value="Send Feedback"/>\
  </div>\
</div>\
    ',
    
    params: {
      escClose: false,
      closeHTML: false
    },

    sendFeedback: function () {
      var val = this.$('textarea').val();
      if (val.length > 0) {
        this.state.trigger('feedback:send', this.$('textarea').val());
      } else if (!this.errorShown) {
        this.showEmptyError();
      }
    },
    
    showEmptyError: function () {
      var errorView = new ErrorMessage({
        errors: [{
          errorSummary: 'The field cannot be left blank'
        }]
      });
      this.add(errorView, {selector: '.feedbackForm', prepend: true});
      this.errorShown = true;
      this.resize();
    }
  });

});
