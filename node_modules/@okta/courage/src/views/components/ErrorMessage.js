define(['underscore',
    'shared/views/BaseView',
    'shared/util/TemplateUtil',
    'shared/util/StringUtil'],
  function (_, BaseView, TemplateUtil, StringUtil) {

    var template = '\
      <span class="icon error-24"></span>\
      <h4><strong>{{i18n code="oform.errormsg.title"}}</strong></h4>\
      <ul class="bullets"></ul>\
    ';

    var View = BaseView.extend({
      template: template,
      className: 'okta-infobox-error infobox infobox-error infobox-md margin-btm-25',
      msgTemplate: TemplateUtil.tpl('<li>{{message}}</li>'),

      initialize: function () {
        if (this.model) {
          this.listenTo(this.model, 'request invalid form:clear-errors', this.remove);
        }
      },

      render: function () {
        BaseView.prototype.render.apply(this, arguments);
        if (_.isArray(this.options.errors) && !_.isEmpty(this.options.errors)) {
          _.each(this.options.errors, function (error) {
            this.$('ul').append(this.msgTemplate({message: error.errorSummary}));
          }, this);
        } else {
          this.$('ul').append(this.msgTemplate({
            message: StringUtil.localize('oform.error.unexpected')
          }));
        }
        return this;
      }
    });

    return View;
  });
