define([
  'shared/views/BaseView',
  'shared/util/StringUtil',
  './components/UserPicker'
], function (BaseView, StringUtil, UserPicker) {

  return BaseView.extend({
    template: '\
      <div class="float-r">\
        <div class="save-buttons buttons o-form-control hide">\
          <input type="button" class="button button-primary save"\
            value="{{i18n code="universal-directory.mappings.save"}}">\
          <input type="button" class="button cancel" value="{{i18n code="oform.cancel"}}">\
        </div>\
        <div class="preview-buttons buttons o-form-control hide">\
          <input type="button" class="button button-primary" \
            value="{{i18n code="universal-directory.mappings.preview.exit"}}">\
        </div>\
      </div>\
    ',

    events: {
      'click .save-buttons input.save': function (e) {
        e.preventDefault();
        this.state.trigger('save:mapping');
      },
      'click .preview-buttons input.button-primary': function (e) {
        e.preventDefault();
        this.userPicker.resetPicker();
        this.showSaveButtons();
      }
    },

    initialize: function () {
      this.previewModel = this.options.previewModel;
      this.userPicker = this.add(UserPicker, {
        options: {
          model: this.previewModel,
          field: 'userId',
          placeholder: StringUtil.localize('universal-directory.mappings.preview.placeholder')
        }
      }).last();
      this.listenTo(this.previewModel, 'change:userId', this.swapButtons);
    },

    render: function () {
      BaseView.prototype.render.apply(this, arguments);
      this.showSaveButtons();
      return this;
    },

    swapButtons: function () {
      this.previewModel.get('userId') ? this.showPreviewButtons() : this.showSaveButtons();
    },

    showSaveButtons: function () {
      this.$('.preview-buttons').addClass('hide');
      this.$('.save-buttons').removeClass('hide');
    },

    showPreviewButtons: function () {
      this.$('.save-buttons').addClass('hide');
      this.$('.preview-buttons').removeClass('hide');
    }
  });
});
