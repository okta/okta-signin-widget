define([
  'underscore',
  'shared/views/BaseView',
  'shared/util/TemplateUtil'
], function (_, BaseView, TemplateUtil) {

  var errorTemplate = TemplateUtil.tpl('\
    <div class="infobox infobox-error infobox-border rounded-4 clearfix">\
      <span class="icon error-16"></span>\
      <h4>{{error}}</h4>\
    </div>\
  ');

  var noMappingTemplate = TemplateUtil.tpl('\
    <div class="o-form-fieldset o-form-label-top">\
      <div class="o-form-input">\
        <div class="target-name">{{targetField}}</div><div class="target-type">{{__displayTargetTypeLabel__}}</div>\
      </div>\
    </div>\
  ');

  var nonErrorTemplate = TemplateUtil.tpl('\
    <div class="preview-mapping-result clearfix">\
      <div class="target-name" data-se=previewValue.{{targetField}}>{{__displayValue__}}</div>\
      <div class="target-type">{{__displayTargetTypeLabel__}}</div>\
    </div>\
  ');

  return BaseView.extend({
    tagName: 'div',

    initialize: function () {
      this.mappingData = this.options.mappingData;
      if (this.mappingData.error) {
        this.template = errorTemplate(_.pick(this.mappingData, 'error'));
      } else {
        if (this.mappingData.sourceExpression) {
          this.template = nonErrorTemplate(
            _.pick(this.mappingData, '__displayValue__', '__displayTargetTypeLabel__', 'targetField')
          );
        } else {
          this.template = noMappingTemplate(_.pick(this.mappingData, 'targetField', '__displayTargetTypeLabel__'));
        }
      }
    }
  });
});
