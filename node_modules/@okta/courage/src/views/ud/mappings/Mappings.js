define([
  'shared/views/BaseView',
  './MappingsHeader',
  './MappingsRow'
], function (BaseView, MappingsHeader, MappingsRow) {

  return BaseView.extend({
    className: 'data-list clearfix',

    template: '\
      <div class="data-list-content-wrap">\
        <table class="data-list-table o-form">\
          <tbody id="property-mapping"></tbody>\
        </table>\
      </div>\
    ',

    initialize: function () {
      this.add(MappingsHeader, {
        selector: '.data-list-table',
        options: {
          appModel: this.options.appModel
        }
      });
      this.filterTargetCollection();
      this.collection.each(function (model, idx) {
        model.set('__edit__', true);
        this.add(
          MappingsRow,
          {
            selector: '#property-mapping',
            options: {
              model: model,
              idx: idx
            },
            bubble: true
          }
        );
      }, this);
    },

    filterTargetCollection: function () {
      if (this.options.appModel.get('name') === 'office365' &&
          this.state.get('tabId') === 'oktaToApp') {
        var removeModels = [];
        removeModels.push(this.collection.findWhere({targetField: 'licenses'}));
        removeModels.push(this.collection.findWhere({targetField: 'roles'}));
        this.collection.remove(removeModels);
      }
    }
  });
});
