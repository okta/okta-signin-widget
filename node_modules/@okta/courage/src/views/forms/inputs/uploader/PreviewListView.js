define([
  'underscore',
  'shared/views/BaseView',
  'shared/views/Backbone.ListView'
], function (_, BaseView, ListView) {

  function createItem(options) {
    return BaseView.extend({

      className: 'file-upload-preview',

      events: {
        'click .file-upload-cancel': function (e) {
          e.preventDefault();
          e.stopPropagation();
          this.collection.remove(this.model);
        },
      },

      template: options.previewTemplate,

      getTemplateData: function () {
        var data = (options.params.parse || _.identity).call(null, this.model.toJSON());
        // run the per-uploder parse later, after the data is normalized by the per-intance parser
        return (options.parse || _.identity).call(null, data);
      },

      postRender: function () {
        this.$el.prepend('<div class="file-upload-cancel"></div>');
        this.delegateEvents();
      }
    });
  }

  return ListView.extend({
    className: 'file-upload-preview-wrap',
    constructor: function (options) {
      this.item = createItem(options);
      ListView.apply(this, arguments);
    }
  });

});
