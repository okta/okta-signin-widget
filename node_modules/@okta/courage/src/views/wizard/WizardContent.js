define([
  'shared/views/BaseView',
  'shared/views/forms/BaseForm'
],
function (BaseView, BaseForm) {

  return BaseView.extend({
    wizardStateEvents: {
      'change:step': 'render'
    },
    preRender: function () {
      this.removeChildren();
      var View,
          state = this.options.wizardState,
          currentStep = state.getCurrentStep();
      if (currentStep.form) {
        View = BaseForm.extend(currentStep.form);
      }
      else {
        View = currentStep.view;
      }
      var child = this.add(View, {
        options: {
          noButtonBar: true,
          saveOnEnter: false
        }
      }).last();

      child.on('error', function () {
        state.set('error', true);
        state.trigger('wizard:error');
      });

      // capture the "esc" hit on the form and use as a trigger to go back a step
      // this is consistent with the FormDialog behaviour
      child.on('cancel', function () {
        state.trigger('wizard:prev');
      });
    },
    className: 'margin-5'
  });

});
