define(['shared/util/Events',
        'shared/views/BaseView',
        './LogoTitle',
        './AppLogo',
        'shared/views/uploader/Uploader'],
  function (Events, BaseView, LogoTitle, AppLogo, Uploader) {

    var template = '<div class="app-logo-preview clearfix"></div>';

    var View = BaseView.extend({

      className: 'av-section-select-logo clearfix',

      template: template,

      initialize: function () {
        this.title = new LogoTitle({title: this.options.title});
        this.add(this.title, '.app-logo-preview');

        this.logo = new AppLogo({
          image: this.options.image,
          name: this.options.name,
          alt: this.options.alt
        });
        this.add(this.logo, '.app-logo-preview');

        if (this.settings.hasPermission('upload-logo')) {
          this.uploader = new Uploader({endpoint: this.options.endpoint});
          this.add(this.uploader, null, true);

          this.listenTo(this.uploader, Events.UPLOAD_DONE, function (json) {
            if (json.imageUrl) {
              this.logo.updateImage(json.imageUrl);
            }
          });
        }

        return this;
      }
    });

    return View;
  });
