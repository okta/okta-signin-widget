INSTALL-WITH-SHRINKWRAP
=======

* [Description](#description)
* [Using install-with-shrinkwrap](#using-install-with-shrinkwrap)
  * [Install](#install)
  * [Usage](#usage)
* [Developing install-with-shrinkwrap](#developing-install-with-shrinkwrap)
  * [Setup](#setup)
  * [Dev commands](#dev-commands)
  * [Bacon](#bacon)

<a id="description"></a>
## Description

CLI tool that installs a package with minimal, deterministic changes to the shrinkwrap file.

> Use this in all modules that require an *npm-shrinkwrap.json* file.

1. Asserts standard Node and NPM versions for consistent shrinkwrapping
2. Installs exact dependency version (uses `npm install -E`)
  - When upgrading a dependency to a new version, it will figure out whether to use the `--save` or `--save-dev` flag
3. Prunes modules that are not listed in package.json
4. Dedupes duplicated packages
5. Runs `npm-shrinkwrap --dev` to generate a new shrinkwrap
6. Removes `resolved` and `from` fields, which speeds up subsequent `npm install`'s

<a id="using-install-with-shrinkwrap"></a>
## Using install-with-shrinkwrap

<a id="install"></a>
### Install

In your module's root app folder, run `npm install`:
```bash
# Install latest version
[your-module]$ npm install @okta/install-with-shrinkwrap --save-dev
```

Then, expose these [run scripts](https://docs.npmjs.com/misc/scripts) in your *package.json*:

```javascript
// package.json
"scripts": {
  "installsw": "install-with-shrinkwrap",
  "lint-shrinkwrap": "install-with-shrinkwrap --check",
  "lint-shrinkwrap:report": "install-with-shrinkwrap --check --force --out build2/reports/lint/shrinkwrap-checkstyle-result.xml"
}
```

<a id="usage"></a>
### Usage

**Note:** Since these are run scripts, you must pass script arguments after the special option `--`. Read more about how to use run scripts on the [npm-run-script](https://docs.npmjs.com/cli/run-script) page.

#### Installing modules with shrinkwrap

The `installsw` run script works very similarly to [`npm install`](https://docs.npmjs.com/cli/install).


##### Upgrading a module version

When upgrading a module that's already been installed in your *package.json*:

```bash
# Installing a module with a scope and exact version
[your-module]$ npm run installsw -- @okta/i18n@1.1.0-beta.24

# Installing a module without the version
[your-module]$ npm run installsw -- lodash
```

##### Installing a new module

When installing a module that's not in your *package.json*, pass a `--save` or `--save-dev` flag:

```bash
# A devDependency, i.e. something you only need to run for build/test/lint
[your-module]$ npm run installsw -- grunt-contrib-jasmine --save-dev

# A dependency, i.e. a package that you bundle with your library and is
# needed for your module to work
[your-module]$ npm run installsw -- jquery --save
```

#### Verifying that the shrinkwrap file is correct

The `lint-shrinkwrap:report` run script is useful for validating the shrinkwrap in CI - it will generate a checkstyle file that can be consumed by Aperture. Execute this command when running your lint testSuite:

```bash
[your-module]$ npm run lint-shrinkwrap:report
```

If you want to test this behavior in your dev environment without writing to a checkstyle file, you can run:

```bash
[your-module]$ npm run lint-shrinkwrap
```

#### Getting help

Use the `--help` option to see a list of available commands:

```bash
[your-module]$ npm run installsw -- --help
```



<a id="developing-install-with-shrinkwrap"></a>
## Developing install-with-shrinkwrap

<a id="setup"></a>
### Setup

```bash
# 1. Clone the `npm` repo if you don't have it, and navigate to install-with-shrinkwrap
[okta]$ git clone git@github.com:okta/npm.git && cd npm/install-with-shrinkwrap

# 2. Install dependencies
[npm/i18n]$ npm install
```

<a id="dev-commands"></a>
### Dev commands

| Command      | Description
| ------------ | -----------
| **npm test**     | Run unit tests and code coverage
| **npm run lint** | Run the linter

<a id="bacon"></a>
### Bacon

To commit, get the :rocket: and merge through the [install-with-shrinkwrap bacon board](http://bacon.trex.saasure.com/#!/commits/install-with-shrinkwrap).
