var exec    = require('./exec'),
    logger  = require('winston');

function fail(msg) {
  logger.error();
  logger.error(`${msg.title} - this will ensure a consistent shrinkwrap`);
  logger.error();
  msg.commands.forEach(function (cmd) {
    logger.error(`# ${cmd.comment}`);
    logger.error(`${cmd.command}`);
    logger.error();
  });
  process.exit(1);
}

module.exports = function (config) {
  logger.cli();
  if (process.versions.node !== config.expectedNodeVersion) {
    fail({
      title: `UPDATE YOUR VERSION OF NODE TO ${config.expectedNodeVersion}`,
      commands: [
        { comment: '1. Install "n", a module that allows you to easily manage node versions',
          command: '$ npm install -g n' },
        { comment: `2. Install node@${config.expectedNodeVersion} by running:`,
          command: `$ n  ${config.expectedNodeVersion}` }
      ]
    });
  }
  if (exec('npm -v', null, true).trim() !== config.expectedNPMVersion) {
    fail({
      title: `UPDATE YOUR VERSION OF NPM TO ${config.expectedNPMVersion}`,
      commands: [
        { comment: `Upgrade to npm@${config.expectedNPMVersion}`,
          command: `$ npm install -g npm@${config.expectedNPMVersion}` }
      ]
    });
  }
};
